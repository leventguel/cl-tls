(defpackage :des-utils
  (:use :cl :shared-utils)
  (:export :byte-vector-to-string :string-to-byte-vector :string-to-hex 
	   :hex-string-to-byte-vector :hex-to-string :byte-vector-to-hex-string :int-to-byte-vector
	   :int-to-bit-vector :bit-vector-to-int :check-for-vec-type
	   :assert-bit-vector :ensure-bit-length :ensure-bit-value :ensure-bit-table
	   :bit-vector-of-length-p :byte-vector-p :des-block-p :valid-des-input-p
	   :left-shift :split-block :split-key :split-into-6bit-chunks :split-into-blocks
	   :permutation-p :sequencep :check-block-size :shift-buffer-bit :increment-counter :chunk-vector
	   :byte-vector-to-bitstream :bitstream-to-byte-vector :read-file-as-string :write-string-to-file
	   :ede-call :ede-process))

(in-package :des-utils)

(defun byte-vector-to-string (bytes)
  "Convert a byte vector to a string using UTF-8 decoding."
  (coerce (map 'list #'code-char bytes) 'string))

(defun byte-vector-to-string (bytes)
  (map 'string #'code-char bytes))

(defun string-to-byte-vector (str)
  "Convert a string to a vector of bytes using UTF-8 encoding."
  (map 'vector #'char-code str))

(defun string-to-hex (str)
  (format nil "铂О佝ㄣ镥蜚篝蜷铉麸怡翦鲥泗矧篝颟ъ轶舂┅ㄤ彐躅桢麸篝蜷铉ㄨ屮ㄢ翦鲥泗矧麸篝蜷铉ㄨ屮篝蜷铉麸怡翦鲥泗矧桢┅ㄤ彐躅轭舡麸怡翦鲥泗矧鏖漪瑭⒚镱鲥螋轭翦珏轭麸忾鲥泗矧镦戾铉翳咨脑盹篝箝珙殒殂犷忾骈蝮舂戾è怡翦磲脲狎蜥鏖漪哄戾礤铘豉疱鲥泗矧┅ㄤ雉轫弩ㄩ鏖漪瑭箦翩ㄡ蝈怡翦椹熹ㄢ翦ō鏖漪暴瞟┅怡翦螬ㄤ彐躅轭舡麸忾舡鲥泗矧鏖漪瑭⒚镱鲥螋轭翦珏轭麸忾鲥泗矧镦戾铉翳咨脑盹篝箝珙殒殂犷忾骈蝮舂戾è忾趔磲脲狎蜥鏖漪哄戾礤铘豉疱р轸┅ㄤ雉轫弩ㄩ鏖漪瑭箦翩ㄡ蝈忾趔椹熹ㄢ翦ō鏖漪暴瞟┅忾趔┅ㄤ彐躅忾舡鲥泗矧麸轭ㄢ轸螬⒚镱鲥螋忾鲥泗矧麸犷轭翦珏虍蝈漉沐灬礅溽ㄡ沣忾舂ǐí徙博忾舂忾趔洪铋糸犰鲠祯癌ㄤ彐躅汨邈氕骘颦鲥悱豉疱鲥悌ㄦ矧磲⒃疱连体铉翳窿アㄡ蝌狴屐屙孱舡豉疱鲥悌戾铉翳鲥悌┅ㄤ彐躅狍箦螋忾舡鲥泗矧鲥悌⒘篌弪趔翳狒峙轶忾舡鲥泗矧ㄥ戾礤铘豉疱Ж躅箝珙邃怡翦暴┊ㄡ篌弪ㄢ轸鲥泗矧鲥悌ī⑴疱泗邃忾舡鲥泗矧顼立豉疱镦鲥悌┅ㄤ彐躅孱篚蝈忾舡戾铉翳鲥屮疱泗邃戾铉翳⒘篌弪翳狒峙轶忾舡鲥泗矧镦咆信迷拍膛吻匀ㄥ铙躜瀛忾舡鲥泗矧鲥悌ㄡ篌弪戾铉翳鲥悌屮疱泗邃戾铉翳ī⑴疱泗邃戾铉翳默顼蘑屮疱泗邃戾铉翳戾铉翳鲥悌┅ㄤ彐躅孱篚蝈忾舡鲠祯鲥悌⒘篌弪翳狒弼弪鲠祯轭峙轶彘翳弪矧碑ㄥ铙躜瀛忾舡鲥泗矧鲥悌ㄡ篌弪ㄥ鲥蝙灬礅溽ㄢ礤礅弪Ж暴┅鲥悌ī⒙轸鲥泗矧泔铘衢铙铒瞽忾鲠祯弩立鲥悌ㄤ彐躅孱篚蝈忾舡翎忪翎忪磲痫箝糸镱⒘篌弪翳狒粤绿轶痱镳弪疱蝽豸狒轱秭弪忾痫箝糸镱螽ㄡ篌弪鲥泗矧翎忪濠ī⑿弪眭翎糸镱翎忪眭篝忮鲥泗矧顼立豉疱镦翎忪濠ㄡ篌弪ㄥ鲥蝙灬礅溽ㄡ钿ㄩ铘彗弪窘暴冀磲痫箝糸镱┅翎忪濠ī⑿弪眭翎糸镱翎忪泔铘衢铙轭鲠扉痫箝糸镱蠛立翎忪濠ㄤ彐躅忾舡鲥泗矧镦戾铉翳鲥戾瞟ㄡ钿ㄢ轸鲥泗矧鲥悌戾铉翳鲥悌戾瞟┅ㄤ彐躅怡翦鲥泗矧鲥悌ㄡ钿鲥泗矧鲥悌ㄥ聃犰ㄡ蝌狴屐屙孱舡豉疱鲥悌Ж躅箝珙邃怡翦俯┅ㄤ彐躅溴蟓忪镢氕鲥悌ㄢ轸鲥泗矧镦戾铉翳鲥洞┅骘洞忾忪镢塍ㄤ彐躅鲠扉洵溴蟓轭瘐舡鲥悌ㄡ钿ㄢ轸鲥泗矧鲥悌戾铉翳鲥悌洞ㄥ鲥蝙灬礅溽ㄢ礤礅弪Ж暴┅鲥悌┅ㄤ彐躅戾骠箬殒ㄢ轸瞟⒚轵沲灬戾骠箬殒镦忾鲥泗矧怡痫箝糸镱螽戾è戾戾铉翳忾趔┅ㄣ镱汜翦钺翦鲥泗矧篚怏羼忾趔戾瞟篚怏羼忾趔瞟┅ㄤ彐躅箴扉舡忪镢ㄢ祜汶⒂痨轸洞忾忪镢轭麸戾骠犷蜷玷巢忾栳祧弩鲠祯弩篚怏羼忪镢巢体骠栳戽篚怏羼忪镢巢洞┅议玷栳戽ㄤ彐躅箴扉舡脲脲刀⒂痨轸刀忾脲轭麸冒犷陌ú忾趔遽汨┊鲠祯弩篚怏羼脲刀哺冒篚怏羼脲刀哺刀┅陌ㄤ彐躅箴扉舡轭麸垛轸汨躅塍ㄢ轸螬⒂痨轸锤忾鲥泗矧轭麸汨躅塍镦忾趔遽汨躅戾篌戾铉翳忾趔锤ㄥ蝌矧⑴疱泗邃锤忾轭瘐衄顼忾趔戾铉翳忾趔┅戾è汨躅塍磲脲狎蜥俯┅ㄤ雉轫弩ㄩ俯箦翩ㄡ蝈汨躅塍椹篚怏羼忾趔í订ǐí订订┅汨躅塍┅ㄤ彐躅疱蝽豸狒轱瞽翎忪磲鲠祯濠⒚桢汶殒粤绿轶鲠扉疱蝽豸狒轱镦鲠祯弩骝镯麸土丨至陶女领祜黧漉痨殂狒弩镱禊殒屮痨殂轸禊轭翦钿邃ㄥ绠屮疳铙轱翎忪濠ㄡ钿ㄥ鲥蝙灬礅溽ㄡ钿ㄩ铘彗弪冀磲鲠祯濠┅翎忪濠冀戾铉翳蝈盹鲥漉痨殂狒弩翎忪濠磲鲠祯濠┅ㄤ彐躅汨邈氕忪镢氕箝ㄤ狒镳糸镱犰ㄢ祜汶箝俯⑴铙躜弩牧粤蝈痱弩孱趔眭祠轲戾镦绿厦谁由谂怡翦螽躅戾篌矧篝蜷铉溽翎ㄢ轸鲥泗矧溽翎┅戾è麸翎飙怡翦ㄣ镱è鲥泗矧溽翎戾铉翳溽翎┅骒狒怡翦鲥泗矧è扉篝溽翎蝈漉沐＇溽翎弘妁＇戾铉翳┅扉篝镦鲥泗矧ㄥ蝌矧⒄铙躔痫螋邃溽翎豉疱立豉疱镦溽翎┅┅┅躅戾篌弪镳盹麸翎飙怡翦忪镢氕箝濠ㄥ蝌矧⒛狒眭篝忮眭祠轲戾镦怡翦蟋顼蘑忪镢氕箝麸翎飙怡翦螬┅┅ㄤ彐躅箦聃孱沐豉疱箦聃孱沐┅ㄤ彐躅汨邈氕忪镢氕箝ㄤ狒镳糸镱犰ㄢ祜汶箝俯⒚桢汶翳狒溽翎轶彘翳弪骒狒箦聃孱沐溟鲩箝忪怡忪镢氕箝瀣矧扉篝镦箦聃孱沐犰镦戾铉翳忪镢氕箝瀹ㄣ镱è犷扉篝溽翎ㄥ鲥蝙＇箦聃孱沐溽翎┅躅戾篌ㄥ鲥蝙灬礅溽ㄢ祜汶戾铉翳忪镢氅忪镢氕箝濠溽翎ㄥ蝌矧⒙祜汶箝黹箜狒汨┅è箦聃孱沐溽翎躅戾篌弪镳盹戾铉翳溽翎忪镢氕箝濠ㄥ蝌矧⑵灬箦聃孱沐戾铉翳铒溟鲩箝忪怡忪镢箝澧┅ㄥ蝌矧⑸铞犰殇溽翎骘蝽狒骘忪镢箝汨邈擘┅┅ㄤ彐躅箬殒舡怩骀弪忾ㄢ蹑驽忾舂戾舄è忾舡扉篝祜镳骘徙蝻篌怩骀弪狃疱钿祜镳骘骝镯滹黝麸泔祆邈熹ㄢ翦椹猢┅铄鳝忾趔ㄡ痧孱篚怏羼忾舡扉篝暴扉篝忾舂┅铄鳝怡翦祜镳骘骝镯忮祜戾铉翳铄鳝忾趔怡泔祆邈蝈漉沐灬礅溽ㄡ沣猢ǐí徙博猢篚怏羼铄鳝忾趔ǐ俯┅┅ㄣ镥蜚铄鳝怡翦鲥泗矧┅ㄤ彐躅箬殒舡怩骀弪忾ㄢ蹑驽忾舂戾è铄鳝怩骀弪磲脲狎蜥戾铉翳怩骀弪哄戾礤铘豉疱Ж躅箝珙邃怡翦暴┅祜镳骘骝镯忮祜ō戾铉翳怩骀弪暴滹箦翩ㄡ蝈铄鳝怩骀弪椹ㄡ蝈怩骀弪ǐ暴┅箦翩ㄡ蝈铄鳝怩骀弪ō戾铉翳怩骀弪暴忾舂铄鳝怩骀弪┅ㄤ彐躅轭泸屙孱舡泔躅翦ㄣ秕铘弪戾è铄ㄣ镳箦泔躅翦颟┅祜镳骘骝镯ū戾铉翳铄鳗滹黝麸滹ㄩ钽ㄡ蝈铄椹麒孱ㄡ蝈铄椹驳订蝈趱蝾┅铄鳗ㄤ彐躅汨躅氕鲥泗矧鲥忪镢氕箝濠祜镳骘骝镯忮祜戾铉翳鲥悌怡忪镢氕箝泔祆邈篚怏羼鲥黹戾铉翳鲥悌ǐ忪镢氕箝濠┅┅ㄤ彐躅怡翦鲥泗矧麸忾趔趄遽ㄢ翦螬⒚镱鲥螋怡翦鲥泗矧麸扉篝镦忾趔ò矧暴祜镳骘怡翦徙蝻篌怡翦狃疱钿祜镳骘骝镯滹黝麸泔祆邈熹ㄢ翦椹怡翦┅┅ㄤ彐躅忾趔趄遽憝麸怡翦鲥泗矧ㄢ轸螬⒚镱鲥螋扉篝镦忾趔麸怡翦鲥泗矧戾è怡翦泔躅ㄦ祜矧戾铉翳忾趔俯┅磲脲狎蜥怡翦泔躅哄戾礤铘豉疱Ж躅箝珙邃怡翦俯洪铋糸犰泔铘孱趔祜镳骘骝镯忮祜í怡翦泔躅俯怡泔祆邈蝈漉沐灬礅溽ㄡ沣忾舂ǐㄡ箬徙暴忾舂篚怏羼忾趔ǐ俯┅┅┅ㄤ彐躅蝈徜骈戾狍篝蜷铉疳翳⒁遽翳孱糸蝈泔铘孱趔镦骈戾狍篝蜷铉鏖翳镳孱骈戾ㄩ疳翳轰轵邈糸镱洪铕豸戾è泔铘孱趔磲脲篝蜷铉ㄦ殪瀛戾铉翳轭┅┅蝈徜箦聃孱沐泔铘孱趔轭泔铘孱趔┅ㄤ彐躅黩轸瀛篝蜷铉麸骈戾疳翳篝颟⒆蜷翦篝蜷铉麸骈戾秭弪黩轸轭殒轸屮轶趔鏖翳镳孱骈戾秕疳翳轰轵邈糸镱猴豸瘐洪姝屮轶趔后躔弪箦溴洪姝滹弩铒舡屮轶恒蝈狒濠黩轸瀛篝蜷铉篝秕舂┅ㄤ彐躅邃瀛汜祆ㄦ溽翎脲镳糸镱犰轹ㄩ轹ㄦ躅汜祆骖溽翎脲轹ㄦ躅汜祆骖溽翎脲┅ㄤ彐躅邃瀛痱镢弩盹溴骖溽翎脲脲镳糸镱犰轹戾舄è篝屦ㄥ溴汜祆盹溴骖溽翎脲轹┅篝屦ㄥ溴汜祆盹溴骖篝屦脲轹┅ㄥ溴汜祆盹溴骖篝屦脲轹┅